@inherits LayoutComponentBase

<MudThemeProvider @ref="_mudThemeProvider"
                  @bind-IsDarkMode="_isDarkMode"
                  Theme="Configuration.Theme" />
<MudSnackbarProvider />
<MudDialogProvider />

<AuthorizeView>
    <Authorized>
        <MudLayout>
            <MudAppBar Style="display: flex;">
                <!-- Botão para abrir o menu lateral -->
                <MudIconButton Icon="@Icons.Material.Filled.Menu"
                               Color="Color.Inherit"
                               Edge="Edge.Start"
                               OnClick="ToggleMenuDrawer" />

                <!-- Logo -->
                <img src="imgs/orbis.png"
                     alt="Dima - Controle Financeiro"
                     width="100" />

                <!-- Campo de pesquisa -->
                <MudGrid Justify="Justify.Center">
                    <MudItem xs="12" md="10">
                        <MudTextField @bind-Value="@_searchTerm"
                                      Placeholder="Pesquise"
                                      FullWidth="true"
                                      Adornment="Adornment.End"
                                      AdornmentIcon="@Icons.Material.Filled.Search"
                                      IconSize="Size.Large" />
                    </MudItem>
                </MudGrid>

                <!-- Saudação ao usuário -->
                <MudText Typo="Typo.caption" Style="margin-right: 6rem;">
                   Bem vindo, <b>@context.User.Identity?.Name</b>
                </MudText>

                <!-- Switch para alternar o tema (dark/light) -->
                <MudSwitch Color="Color.Inherit"
                           @bind-Value="@_isDarkMode"
                           T="bool"
                           ThumbIcon="@Icons.TwoTone.Lightbulb" />

                <!-- Ícone do usuário para abrir o drawer de informações -->
                <MudIconButton Icon="@Icons.Material.Filled.AccountCircle"
                               Color="Color.Inherit"
                               OnClick="ToggleUserDrawer"
                               Size="Size.Large" />
            </MudAppBar>

            <!-- Drawer para o menu de navegação -->
            <MudDrawer @bind-Open="_isMenuDrawerOpened"
                       ClipMode="_clipModeMenu"
                       Breakpoint="@_breakpoint"
                       Elevation="1"
                       Variant="DrawerVariant.Mini"
                       Color="Color.Inherit">
                <MudNavMenu Color="Color.Inherit">
                    <MudFab Color="Color.Inherit"
                            StartIcon="@Icons.Material.Filled.Add"
                            Size="Size.Medium" />
                    <MudNavLink Match="NavLinkMatch.All"
                                Icon="@Icons.Material.Filled.Article"
                                OnClick="LoadDocuments">Acervo</MudNavLink>
                    <MudNavLink Match="NavLinkMatch.All"
                                Icon="@Icons.Material.Filled.AdminPanelSettings">Configurações</MudNavLink>
                    <MudNavLink Match="NavLinkMatch.All"
                                Icon="@Icons.Material.Filled.ManageAccounts">Workflow</MudNavLink>
                    <MudNavLink Match="NavLinkMatch.All"
                                Icon="@Icons.Material.Filled.History">Relatórios</MudNavLink>
                </MudNavMenu>
            </MudDrawer>

            <!-- Drawer para exibir as informações do usuário -->
            <MudDrawer @bind-Open="_isUserDrawerOpened"
                       Anchor="Anchor.End"
                       Elevation="1"
                       ClipMode="_clipModeMenu"
                       Variant="DrawerVariant.Responsive"
                       Color="Color.Inherit">
                <MudDrawerHeader>
                    <MudText Typo="Typo.subtitle2">
                        <b>Central de Notificações</b>
                    </MudText>
                </MudDrawerHeader>
                <MudList>
                    <MudListItem>
                        <MudText Typo="Typo.caption">
                            Informações do Usuário
                            <MudNavLink Match="NavLinkMatch.All">Alterar Senha</MudNavLink>
                            <MudNavLink Match="NavLinkMatch.All" Href="/logout">Desconectar</MudNavLink>
                        </MudText>
                    </MudListItem>
                </MudList>
            </MudDrawer>

            <!-- Conteúdo principal da página -->
            <MudMainContent>
                <MudContainer Class="mt-4">
                    @Body
                     <!-- Tabela de Tipos de Documentos -->
                    <MudGrid Justify="Justify.FlexEnd">
                        <MudItem xs="12" md="20">
                            <MudTable Items="@documentos">
                                <HeaderContent>
                                    <MudTh>Tipo de Documento</MudTh>
                                    <MudTh>Total</MudTh>
                                </HeaderContent>
                                <RowTemplate Context="doc">
                                    <MudTd Style="display: flex; align-items: center;">
                                        <MudIcon Icon="@Icons.Material.Outlined.Folder" Style="margin-right: 8px;" /> @doc.Nome
                                    </MudTd>
                                    <MudTd>@doc.Total</MudTd>
                                </RowTemplate>
                            </MudTable>
                        </MudItem>
                    </MudGrid>

                </MudContainer>
            </MudMainContent>
        </MudLayout>
    </Authorized>
    <NotAuthorized>
        <LoginRedirect />
    </NotAuthorized>
</AuthorizeView>

@code {
    // Controle do Drawer de navegação (menu lateral)
    private bool _isMenuDrawerOpened = true;

    // Controle do Drawer de informações do usuário
    private bool _isUserDrawerOpened = false;

    // Controle do modo Dark/Light
    private bool _isDarkMode = true;

    private MudThemeProvider _mudThemeProvider = null!;
    private Breakpoint _breakpoint = Breakpoint.Sm;
    private DrawerClipMode _clipModeMenu = DrawerClipMode.Always;
    private string _searchTerm;

    public class Documento
    {
        public string Nome { get; set; }
        public int Total { get; set; }
    }

    // Exemplo de lista de documentos
    private List<Documento> documentos = new List<Documento>();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _isDarkMode = await _mudThemeProvider.GetSystemPreference();
            await _mudThemeProvider.WatchSystemPreference(OnSystemPreferenceChanged);
            LoadDocuments();
            StateHasChanged();
        }
    }

    private Task OnSystemPreferenceChanged(bool newValue)
    {
        _isDarkMode = newValue;
        StateHasChanged();
        return Task.CompletedTask;
    }

    // Método para alternar o Drawer de navegação (menu lateral)
    private void ToggleMenuDrawer()
    {
        _isMenuDrawerOpened = !_isMenuDrawerOpened;
    }

    // Método para alternar o Drawer de informações do usuário
    private void ToggleUserDrawer()
    {
        _isUserDrawerOpened = !_isUserDrawerOpened;
    }

    // Método para carregar os documentos ao clicar em "Acervo"
    private void LoadDocuments()
    {
        // Adicione a lógica de carregamento de documentos aqui.
        // Pode ser uma chamada de API ou uma consulta ao banco de dados.
        documentos = new List<Documento>
        {
            new Documento { Nome = "ATA", Total = 406 },
            new Documento { Nome = "Contrato", Total = 15 },
            new Documento { Nome = "Contrato AB", Total = 2 },
            new Documento { Nome = "Contrato de Locação de Equipamentos", Total = 1 },
            new Documento { Nome = "Teste", Total = 1 },
            new Documento { Nome = "ATA", Total = 406 },
            new Documento { Nome = "Contrato", Total = 15 },
            new Documento { Nome = "Contrato AB", Total = 2 },
            new Documento { Nome = "Contrato de Locação de Equipamentos", Total = 1 },
            new Documento { Nome = "Teste", Total = 1 },
            new Documento { Nome = "ATA", Total = 406 },
            new Documento { Nome = "Contrato", Total = 15 },
            new Documento { Nome = "Contrato AB", Total = 2 },
            new Documento { Nome = "Contrato de Locação de Equipamentos", Total = 1 },
            new Documento { Nome = "Teste", Total = 1 },
            // Outros documentos...
        };

        StateHasChanged();
    }
}

